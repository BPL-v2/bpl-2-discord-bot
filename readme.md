# Discord Bot for BPL

## How this works

We use https://github.com/bwmarrin/discordgo to implement the http server/client for the discord bot.
In addition we also have a gin http server to accept http calls from the backend and an autogenerated http client to send calls to the backend.

For the calls to the backend server we need to authenticate the client with our backend.

The communication from the backend to our gin http server is over the docker network only so that api is not exposed to the public.

## How to set up locally

### Creating a discord test server

- https://support.discord.com/hc/en-us/articles/204849977-How-do-I-create-a-server

- Right click on the server icon and select "Copy Discord Id" and use as environment variable DISCORD_GUILD_ID

### Creating a discord bot

Go to https://discord.com/developers/applications and create new Application

### Adding Oauth2 redirects to your backend

Navigate to Settings > Oauth2 > Add redirects

- https://redirectmeto.com/http://localhost:8000/api/oauth2/discord/redirect
- https://redirectmeto.com/http://localhost/api/oauth2/discord/redirect

Discord only accepts https redirect urls so we need redirectmeto to make it work with localhost

### Adding bot to your test server

Settings > Installation > Copy install link > Paste into browser > Add to server

### Setting up environment variables

- DISCORD_CLIENT_ID
  - Dev Portal > Settings > Oauth2 > Client information > Client Id
- DISCORD_CLIENT_SECRET
  - Dev Portal > Settings > Oauth2 > Client information > Client Secret
- DISCORD_BOT_TOKEN
  - Dev Portal > Settings > Bot > Reset Token
- DISCORD_GUILD_ID
  - Discord > Right click server icon > Copy Discord Id

## Updating the backennd client

Run the backend go server on localhost and execute

```
./update-client.sh
```

to get the newest spec
